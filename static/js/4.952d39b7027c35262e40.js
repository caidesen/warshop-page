webpackJsonp([4],{"+5Lg":function(i,t){},PR0Q:function(i,t){},mtgm:function(i,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("BO1k"),a=e.n(s),o=e("Tg7E"),n=e("SYO7"),c={name:"uploadPic",props:{value:{type:Boolean},pic:{type:Object}},data:function(){return{popupVisible:!1,file:"",src:"",fileNameExtension:"",progress:0,Uploading:!1,UploadingProgress:!1}},methods:{choiceImg:function(){this.$refs.filElem1.dispatchEvent(new MouseEvent("click"))},getFile:function(i){var t=this;this.file=i.target.files[0];var e=this.file;if(i&&window.FileReader){var s=new FileReader;s.readAsDataURL(e),s.onloadend=function(){t.src=this.result},this.fileNameExtension=this.file.name.substr(this.file.name.lastIndexOf("."))}},upload:function(){var i=this;!1===this.Uploading&&(this.Uploading=!0,this.UploadingProgress=!0,this.axios({url:"/auth/pic/put/token",method:"get",headers:{token:this.$store.state.user.token},params:{fileNameExtension:this.fileNameExtension}}).then(function(t){var e=t.data.data.date,s="http://v0.api.upyun.com"+t.data.data.uri,a=t.data.data.token,c=t.data.data.picName;console.log(e+""),console.log(s+""),console.log(a),i.end=0,i.progress=0,i.axios({url:s,method:"put",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Date":e,Authorization:a},onUploadProgress:function(t){if(t.lengthComputable){var e=Math.round(t.loaded/t.total*100);e<98&&setInterval(function(){var t=e-i.progress;t>0&&(i.progress=i.progress+t/(t>10?40:2),t=e-i.progress)},20)}},data:i.file}).then(function(){i.axios({url:"/item/pic",method:"post",headers:{token:i.$store.state.user.token},params:{picName:c}}).then(function(t){i.Uploading=!1,Object(o.Toast)({message:"操作成功",iconClass:"icon icon-success",className:"errorToast"}),i.end=100,i.progress=100,setTimeout(function(){i.UploadingProgress=!1},500);var e={src:"http://warshop.test.upcdn.net"+t.data.data.picUri,picId:t.data.data.picId};i.$emit("changeSrc",e)}).catch(function(t){Object(n.a)(t),i.Uploading=!1})}).catch(function(t){Object(n.a)(t),i.Uploading=!1})}).catch(function(t){Object(n.a)(t),i.Uploading=!1}))},deletePic:function(){var i=this;this.axios({url:"/item/pic/"+this.pic.picId,method:"delete",headers:{token:this.$store.state.user.token}}).then(function(){i.$emit("delete"),i.src=i.pic.src,Object(o.Toast)({message:"操作成功",iconClass:"icon icon-success",className:"errorToast"})}).catch(function(i){Object(n.a)(i)})}},watch:{popupVisible:function(i){!1===i?this.$emit("input",i):this.src=this.pic.src},value:function(i){this.popupVisible=i}}},p={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{attrs:{id:"uploadPic"}},[e("mt-popup",{staticClass:"popupUpload",attrs:{"popup-transition":"popup-fade"},model:{value:i.popupVisible,callback:function(t){i.popupVisible=t},expression:"popupVisible"}},[e("div",{staticClass:"center-d"},[e("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"filElem1",attrs:{id:"file",type:"file"},on:{change:function(t){return i.getFile(t)}}}),i._v(" "),e("div",{staticClass:"img-d"},[e("img",{attrs:{src:i.src,alt:"点击选择"},on:{click:i.choiceImg}})]),i._v(" "),e("div",[i.UploadingProgress?[e("mt-progress",{attrs:{value:i.progress,"bar-height":5}})]:i._e(),i._v(" "),i.pic.uploaded?i._e():[e("mt-button",{attrs:{type:"primary",size:"small"},on:{click:i.upload}},[i._v("上传")])],i._v(" "),i.pic.uploaded?[e("mt-button",{attrs:{type:"danger",size:"small"},on:{click:i.deletePic}},[i._v("删除")])]:i._e()],2)])])],1)},staticRenderFns:[]};var r={name:"uploadPics",components:{uploadPic:e("VU/8")(c,p,!1,function(i){e("+5Lg")},"data-v-4c349ec7",null).exports},data:function(){return{initialPic:e("L1Jm"),pics:[{src:void 0,uploaded:!1,picId:void 0},{src:void 0,uploaded:!1,picId:void 0},{src:void 0,uploaded:!1,picId:void 0},{src:void 0,uploaded:!1,picId:void 0},{src:void 0,uploaded:!1,picId:void 0}],popupVisible:!1,uploading:0}},methods:{pupupUpload:function(i){this.popupVisible=!0,this.uploading=i},changeSrc:function(i){this.pics[this.uploading].src=i.src,this.pics[this.uploading].uploaded=!0,this.pics[this.uploading].picId=i.picId,this.$store.commit("addItem/changePics",this.pics)},deleteSrc:function(){this.pics[this.uploading].src=this.initialPic,this.pics[this.uploading].uploaded=!1,this.pics[this.uploading].picId=void 0,this.$store.commit("addItem/changePics",this.pics)}},mounted:function(){var i=!0,t=!1,e=void 0;try{for(var s,o=a()(this.pics);!(i=(s=o.next()).done);i=!0){s.value.src=this.initialPic}}catch(i){t=!0,e=i}finally{try{!i&&o.return&&o.return()}finally{if(t)throw e}}}},d={render:function(){var i=this,t=i.$createElement,e=i._self._c||t;return e("div",{attrs:{id:"uploadPics"}},[e("div",i._l(i.pics,function(t,s){return e("div",{key:s,staticClass:"pic-d",on:{click:function(t){return i.pupupUpload(s)}}},[e("div",{attrs:{id:"top"}},[e("img",{attrs:{src:t.src,alt:""}})]),i._v(" "),e("div",[e("span",[i._v(i._s(s+1))])])])}),0),i._v(" "),e("upload-pic",{attrs:{pic:i.pics[i.uploading]},on:{changeSrc:i.changeSrc,delete:i.deleteSrc},model:{value:i.popupVisible,callback:function(t){i.popupVisible=t},expression:"popupVisible"}})],1)},staticRenderFns:[]};var l=e("VU/8")(r,d,!1,function(i){e("PR0Q")},"data-v-abb4176e",null);t.default=l.exports}});